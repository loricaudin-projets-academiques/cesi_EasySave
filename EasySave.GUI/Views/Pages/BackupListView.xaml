<UserControl x:Class="EasySave.GUI.Views.Pages.BackupListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="750">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Page Header -->
        <DockPanel Grid.Row="0" Margin="0,0,0,20">
            <StackPanel DockPanel.Dock="Left">
                <TextBlock Text="{Binding PageTitle}" FontSize="24" FontWeight="Bold" 
                           Foreground="{StaticResource TextPrimaryBrush}" FontFamily="{StaticResource AppFont}"/>
                <TextBlock Text="{Binding StatusMessage}" FontSize="12" 
                           Foreground="{StaticResource TextMutedBrush}" FontFamily="{StaticResource AppFont}" Margin="0,4,0,0"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right" VerticalAlignment="Top">
                <Button Style="{StaticResource IconButtonStyle}" Width="38" Height="38" Margin="0,0,6,0"
                        Command="{Binding RefreshListCommand}" 
                        IsEnabled="{Binding IsRunning, Converter={StaticResource InverseBooleanConverter}}"
                        ToolTip="{Binding RefreshButtonText}">
                    <TextBlock Text="&#xE72C;" FontFamily="Segoe MDL2 Assets" FontSize="15"/>
                </Button>
                <Button Style="{StaticResource SecondaryButtonStyle}" Margin="0,0,8,0"
                        Command="{Binding RunSelectedCommand}" 
                        IsEnabled="{Binding IsRunning, Converter={StaticResource InverseBooleanConverter}}"
                        Content="{Binding RunSelectedButtonText}" MinWidth="100"/>
                <Button Style="{StaticResource SecondaryButtonStyle}" Margin="0,0,8,0"
                        Command="{Binding RunAllCommand}" 
                        IsEnabled="{Binding IsRunning, Converter={StaticResource InverseBooleanConverter}}"
                        Content="{Binding RunAllButtonText}" MinWidth="100"/>
                <Button Style="{StaticResource PrimaryButtonStyle}"
                        Command="{Binding AddBackupCommand}" 
                        IsEnabled="{Binding IsRunning, Converter={StaticResource InverseBooleanConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE710;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="{Binding AddButtonText}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </DockPanel>

        <!-- Delete confirmation banner -->
        <Border Grid.Row="1" Background="{StaticResource WarningLightBrush}" BorderBrush="{StaticResource WarningBrush}" 
                BorderThickness="1" CornerRadius="10" Padding="16" Margin="0,0,0,14"
                Visibility="{Binding IsDeleteConfirmVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <DockPanel>
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                    <Button Content="{Binding CancelText}" Style="{StaticResource SecondaryButtonStyle}" MinWidth="100" Margin="0,0,8,0" Command="{Binding CancelDeleteCommand}"/>
                    <Button Content="{Binding ConfirmDeleteText}" Style="{StaticResource DangerButtonStyle}" MinWidth="120" Command="{Binding ConfirmDeleteCommand}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="&#xE7BA;" FontFamily="Segoe MDL2 Assets" FontSize="16" 
                               Foreground="{StaticResource WarningBrush}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <TextBlock Text="{Binding StatusMessage}" Foreground="{StaticResource TextPrimaryBrush}" 
                               VerticalAlignment="Center" FontFamily="{StaticResource AppFont}"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- Global controls -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,14">
            <Button Style="{StaticResource SecondaryButtonStyle}" MinWidth="90" Margin="0,0,8,0"
                    Command="{Binding PauseAllCommand}" IsEnabled="{Binding IsRunning}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="&#xE769;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <TextBlock Text="Pause All" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
            <Button Style="{StaticResource SecondaryButtonStyle}" MinWidth="90" Margin="0,0,8,0"
                    Command="{Binding ResumeAllCommand}" IsEnabled="{Binding IsRunning}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="&#xE768;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <TextBlock Text="Resume All" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
            <Button Style="{StaticResource DangerButtonStyle}" MinWidth="90"
                    Command="{Binding StopAllCommand}" IsEnabled="{Binding IsRunning}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="&#xE71A;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0" Foreground="White"/>
                    <TextBlock Text="Stop All" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
        </StackPanel>

        <!-- Backup cards list -->
        <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto" Margin="0,0,0,0">
            <ItemsControl ItemsSource="{Binding Backups}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource CardStyle}">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Checkbox for multi-select -->
                                    <CheckBox Grid.Column="0" IsChecked="{Binding IsSelected}" VerticalAlignment="Center" Margin="0,0,12,0"/>

                                    <!-- Type badge -->
                                    <Border Grid.Column="1" Width="44" Height="44" CornerRadius="10" 
                                            Background="{StaticResource AccentLightBrush}" Margin="0,0,16,0" VerticalAlignment="Center">
                                        <TextBlock Text="&#xE8F1;" FontFamily="Segoe MDL2 Assets" FontSize="18" 
                                                   Foreground="{StaticResource AccentBrush}" 
                                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>

                                    <!-- Info -->
                                    <StackPanel Grid.Column="2" VerticalAlignment="Center">
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                            <TextBlock Text="{Binding Backup.Name, Mode=OneWay}" FontWeight="SemiBold" FontSize="15" 
                                                       Foreground="{StaticResource TextPrimaryBrush}" FontFamily="{StaticResource AppFont}"/>
                                            <Border Background="{StaticResource InputBgBrush}" CornerRadius="4" Padding="8,2" Margin="10,0,0,0" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Backup.Type, Mode=OneWay}" FontSize="11" 
                                                           Foreground="{StaticResource TextSecondaryBrush}" FontFamily="{StaticResource AppFont}"/>
                                            </Border>
                                        </StackPanel>
                                        <TextBlock FontSize="12" Foreground="{StaticResource TextMutedBrush}" FontFamily="{StaticResource AppFont}" Margin="0,0,0,2">
                                            <Run Text="&#xE8B7;" FontFamily="Segoe MDL2 Assets" FontSize="10"/>
                                            <Run Text=" "/>
                                            <Run Text="{Binding Backup.SourcePath, Mode=OneWay}"/>
                                        </TextBlock>
                                        <TextBlock FontSize="12" Foreground="{StaticResource TextMutedBrush}" FontFamily="{StaticResource AppFont}">
                                            <Run Text="&#xE8A9;" FontFamily="Segoe MDL2 Assets" FontSize="10"/>
                                            <Run Text=" "/>
                                            <Run Text="{Binding Backup.DestinationPath, Mode=OneWay}"/>
                                        </TextBlock>
                                    </StackPanel>

                                    <!-- Action buttons: Toggle Play/Pause + Stop + Edit + Delete -->
                                    <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0,0,0">
                                        <!-- Toggle Play/Pause button -->
                                        <Button Width="38" Height="38" MinWidth="38" Padding="0"
                                                Command="{Binding DataContext.TogglePlayPauseCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}" Margin="0,0,6,0">
                                            <Button.Style>
                                                <Style TargetType="Button" BasedOn="{StaticResource SuccessButtonStyle}">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding JobState}" Value="Running">
                                                            <Setter Property="Background" Value="#FF9800"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                            <TextBlock Text="{Binding ToggleIcon}" FontFamily="Segoe MDL2 Assets" FontSize="14" Foreground="White"/>
                                        </Button>
                                        <!-- Stop button -->
                                        <Button Style="{StaticResource DangerButtonStyle}" Width="38" Height="38" MinWidth="38" Padding="0"
                                                Command="{Binding DataContext.StopJobCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}" Margin="0,0,6,0"
                                                IsEnabled="{Binding IsStopVisible}"
                                                ToolTip="Stop">
                                            <TextBlock Text="&#xE71A;" FontFamily="Segoe MDL2 Assets" FontSize="14" Foreground="White"/>
                                        </Button>
                                        <Button Style="{StaticResource IconButtonStyle}" Width="38" Height="38"
                                                Command="{Binding DataContext.EditBackupCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}" Margin="0,0,6,0" ToolTip="Edit">
                                            <TextBlock Text="&#xE70F;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                                        </Button>
                                        <Button Style="{StaticResource IconButtonStyle}" Width="38" Height="38"
                                                Command="{Binding DataContext.RequestDeleteBackupCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}" ToolTip="Delete">
                                            <TextBlock Text="&#xE74D;" FontFamily="Segoe MDL2 Assets" FontSize="14"/>
                                        </Button>
                                    </StackPanel>
                                </Grid>

                                <!-- Per-item progress bar + percentage -->
                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <ProgressBar Grid.Column="0" Style="{StaticResource ModernProgressBarStyle}"
                                                 Minimum="0" Maximum="100" Value="{Binding Progress}" Height="6"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Progress, StringFormat={}{0:0.0}%}"
                                               FontSize="12" FontWeight="SemiBold" Margin="10,0,0,0"
                                               Foreground="{StaticResource TextSecondaryBrush}" FontFamily="{StaticResource AppFont}"
                                               VerticalAlignment="Center"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>

