<UserControl x:Class="EasySave.GUI.Views.Pages.SettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="700" d:DesignWidth="750">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Page Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                <Border Width="36" Height="36" CornerRadius="8" Background="{StaticResource AccentLightBrush}" Margin="0,0,12,0">
                    <TextBlock Text="&#xE713;" FontFamily="Segoe MDL2 Assets" FontSize="16" 
                               Foreground="{StaticResource AccentBrush}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Border>
                <TextBlock Text="{Binding PageTitle}" FontSize="24" FontWeight="Bold" 
                           Foreground="{StaticResource TextPrimaryBrush}" FontFamily="{StaticResource AppFont}" VerticalAlignment="Center"/>
            </StackPanel>
            <TextBlock Text="{Binding StatusMessage}" FontSize="12" 
                       Foreground="{StaticResource TextMutedBrush}" FontFamily="{StaticResource AppFont}" Margin="48,0,0,0"/>
        </StackPanel>

        <!-- Settings sections -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel>

                <!-- ===== GENERAL SECTION ===== -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <TextBlock Text="&#xE774;" FontFamily="Segoe MDL2 Assets" FontSize="14" 
                                       Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding GeneralLabel}" FontSize="15" FontWeight="SemiBold" 
                                       Foreground="{StaticResource TextPrimaryBrush}" FontFamily="{StaticResource AppFont}"/>
                        </StackPanel>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="{Binding LanguageLabel}" Style="{StaticResource SectionLabelStyle}"/>
                                <ComboBox ItemsSource="{Binding AvailableLanguages}"
                                          SelectedItem="{Binding SelectedLanguage}"
                                          DisplayMemberPath="DisplayName"
                                          HorizontalAlignment="Left"
                                          Style="{StaticResource ModernComboBoxStyle}"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- ===== LOGS SECTION ===== -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <TextBlock Text="&#xE7F4;" FontFamily="Segoe MDL2 Assets" FontSize="14"
                                       Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding LogsLabel}" FontSize="15" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}" FontFamily="{StaticResource AppFont}"/>
                        </StackPanel>

                        <StackPanel Margin="0,20,0,0">
                            <TextBlock Text="{Binding LogsLocalLabel}" FontSize="14" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}" FontFamily="{StaticResource AppFont}"/>

                            <CheckBox Content="{Binding SaveLogsLocalLabel}"
                                      IsChecked="{Binding SaveLogsLocal}"
                                      Margin="0,10,0,10"/>

                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="{Binding LogFormatLabel}"
                                           Style="{StaticResource SectionLabelStyle}"
                                           Grid.Column="0"
                                           VerticalAlignment="Center"/>

                                <ComboBox ItemsSource="{Binding AvailableLogFormats}"
                                          SelectedItem="{Binding SelectedLogFormat}"
                                          Style="{StaticResource ModernComboBoxStyle}"
                                          MaxWidth="200"
                                          HorizontalAlignment="Left"
                                          IsEnabled="{Binding SaveLogsLocal}"
                                          Grid.Column="1"/>
                            </Grid>
                        </StackPanel>

                        <StackPanel Margin="0,20,0,0">
                            <TextBlock Text="{Binding LogsServerLabel}" FontSize="14" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}" FontFamily="{StaticResource AppFont}"/>

                            <CheckBox Content="{Binding SaveLogsServerLabel}"
                                      IsChecked="{Binding SaveLogsServer}"
                                      Margin="0,10,0,10"/>

                            <Grid Margin="0,10,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="{Binding ServerAddressLabel}"
                                           Style="{StaticResource SectionLabelStyle}"
                                           Grid.Column="0"
                                           VerticalAlignment="Center"/>

                                <TextBox Text="{Binding ServerAddress}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         MaxWidth="250"
                                         HorizontalAlignment="Left"
                                         IsEnabled="{Binding SaveLogsServer}"
                                         Grid.Column="1"/>
                            </Grid>

                            <Grid Margin="0,10,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="{Binding ServerPortLabel}"
                                           Style="{StaticResource SectionLabelStyle}"
                                           Grid.Column="0"
                                           VerticalAlignment="Center"/>

                                <TextBox Text="{Binding ServerPort}"
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         MaxWidth="120"
                                         HorizontalAlignment="Left"
                                         IsEnabled="{Binding SaveLogsServer}"
                                         Grid.Column="1"/>
                            </Grid>

                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- ===== ENCRYPTION SECTION ===== -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <TextBlock Text="&#xE72E;" FontFamily="Segoe MDL2 Assets" FontSize="14" 
                                       Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding EncryptExtensionsLabel}" FontSize="15" FontWeight="SemiBold" 
                                       Foreground="{StaticResource TextPrimaryBrush}" FontFamily="{StaticResource AppFont}"/>
                        </StackPanel>

                        <TextBlock Text="{Binding ExtensionPlaceholder}" FontSize="11" 

                                   Foreground="{StaticResource TextMutedBrush}" FontFamily="{StaticResource AppFont}" Margin="0,0,0,6"/>

                        <Grid Margin="0,0,0,4">

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Grid.Column="0" Text="{Binding NewExtension, UpdateSourceTrigger=PropertyChanged}" 
                                     Style="{StaticResource ModernTextBoxStyle}" Margin="0,0,10,0"/>
                            <Button Grid.Column="1" Style="{StaticResource PrimaryButtonStyle}" MinWidth="110" Command="{Binding AddExtensionCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="&#xE710;" FontFamily="Segoe MDL2 Assets" FontSize="11" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding AddExtensionButtonText}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </Grid>

                        <TextBlock Text="{Binding ExtensionError}" FontSize="11" Foreground="{StaticResource DangerBrush}" 

                                   FontFamily="{StaticResource AppFont}" Margin="0,0,0,8"

                                   Visibility="{Binding ExtensionError, Converter={StaticResource StringToVisibilityConverter}}"/>



                        <ItemsControl ItemsSource="{Binding EncryptExtensions}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{StaticResource InputBgBrush}" CornerRadius="6" 
                                            Padding="10,6" Margin="0,0,8,8" BorderBrush="{StaticResource InputBorderBrush}" BorderThickness="1">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding}" VerticalAlignment="Center" FontSize="13"
                                                       Foreground="{StaticResource TextPrimaryBrush}" FontFamily="{StaticResource AppFont}" Margin="0,0,8,0"/>
                                            <Button Style="{StaticResource IconButtonStyle}" Width="22" Height="22"
                                                    Command="{Binding DataContext.RemoveExtensionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}" ToolTip="{Binding RemoveLabel}">
                                                <TextBlock Text="&#xE711;" FontFamily="Segoe MDL2 Assets" FontSize="10"/>
                                            </Button>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- ===== PRIORITY EXTENSIONS SECTION ===== -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <TextBlock Text="&#xE8CB;" FontFamily="Segoe MDL2 Assets" FontSize="14" 
                                       Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding PriorityExtensionsLabel}" FontSize="15" FontWeight="SemiBold" 
                                       Foreground="{StaticResource TextPrimaryBrush}" FontFamily="{StaticResource AppFont}"/>
                        </StackPanel>

                        <TextBlock Text="{Binding ExtensionPlaceholder}" FontSize="11" 

                                   Foreground="{StaticResource TextMutedBrush}" FontFamily="{StaticResource AppFont}" Margin="0,0,0,6"/>

                        <Grid Margin="0,0,0,4">

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Grid.Column="0" Text="{Binding NewPriorityExtension, UpdateSourceTrigger=PropertyChanged}" 
                                     Style="{StaticResource ModernTextBoxStyle}" Margin="0,0,10,0"/>
                            <Button Grid.Column="1" Style="{StaticResource PrimaryButtonStyle}" MinWidth="110" Command="{Binding AddPriorityExtensionCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="&#xE710;" FontFamily="Segoe MDL2 Assets" FontSize="11" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding AddExtensionButtonText}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </Grid>

                        <TextBlock Text="{Binding PriorityExtensionError}" FontSize="11" Foreground="{StaticResource DangerBrush}" 

                                   FontFamily="{StaticResource AppFont}" Margin="0,0,0,8"

                                   Visibility="{Binding PriorityExtensionError, Converter={StaticResource StringToVisibilityConverter}}"/>



                        <ItemsControl ItemsSource="{Binding PriorityExtensions}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{StaticResource InputBgBrush}" CornerRadius="6" 
                                            Padding="10,6" Margin="0,0,8,8" BorderBrush="{StaticResource InputBorderBrush}" BorderThickness="1">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding}" VerticalAlignment="Center" FontSize="13"
                                                       Foreground="{StaticResource TextPrimaryBrush}" FontFamily="{StaticResource AppFont}" Margin="0,0,8,0"/>
                                            <Button Style="{StaticResource IconButtonStyle}" Width="22" Height="22"
                                                    Command="{Binding DataContext.RemovePriorityExtensionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}" ToolTip="Remove">
                                                <TextBlock Text="&#xE711;" FontFamily="Segoe MDL2 Assets" FontSize="10"/>
                                            </Button>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- ===== LARGE FILE THRESHOLD SECTION ===== -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <TextBlock Text="&#xE8B5;" FontFamily="Segoe MDL2 Assets" FontSize="14" 
                                       Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding LargeFileThresholdLabel}" FontSize="15" FontWeight="SemiBold" 
                                       Foreground="{StaticResource TextPrimaryBrush}" FontFamily="{StaticResource AppFont}"/>
                        </StackPanel>

                        <TextBlock Text="{Binding ThresholdPlaceholder}" FontSize="11" 
                                   Foreground="{StaticResource TextMutedBrush}" FontFamily="{StaticResource AppFont}" Margin="0,0,0,6"/>
                        <TextBox Text="{Binding LargeFileThreshold, UpdateSourceTrigger=PropertyChanged}" 
                                 Style="{StaticResource ModernTextBoxStyle}" MaxWidth="200" HorizontalAlignment="Left"
                                 PreviewTextInput="NumericOnly_PreviewTextInput"/>
                        <TextBlock Text="0 = disabled" FontSize="11" Foreground="{StaticResource TextMutedBrush}" 
                                   FontFamily="{StaticResource AppFont}" Margin="0,4,0,0"/>
                        <TextBlock Text="{Binding ThresholdError}" FontSize="11" Foreground="{StaticResource DangerBrush}" 
                                   FontFamily="{StaticResource AppFont}" Margin="0,2,0,0"
                                   Visibility="{Binding ThresholdError, Converter={StaticResource StringToVisibilityConverter}}"/>
                    </StackPanel>
                </Border>

                <!-- ===== BUSINESS SOFTWARE SECTION ===== -->
                <Border Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <TextBlock Text="&#xE7EE;" FontFamily="Segoe MDL2 Assets" FontSize="14" 
                                       Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding BusinessSoftwareLabel}" FontSize="15" FontWeight="SemiBold" 
                                       Foreground="{StaticResource TextPrimaryBrush}" FontFamily="{StaticResource AppFont}"/>
                        </StackPanel>

                        <!-- Current selection display -->
                        <TextBlock Style="{StaticResource SectionLabelStyle}" Margin="0,0,0,6" Text="{Binding SelectedLabel}"/>
                        <TextBlock Text="{Binding BusinessSoftwarePlaceholder}" FontSize="11" 

                                   Foreground="{StaticResource TextMutedBrush}" FontFamily="{StaticResource AppFont}" Margin="0,0,0,6"/>
                        <DockPanel Margin="0,0,0,16">
                            <Button DockPanel.Dock="Right" Style="{StaticResource IconButtonStyle}" Width="36" Height="36" Margin="8,0,0,0"
                                    Command="{Binding ClearBusinessSoftwareCommand}" ToolTip="{Binding ClearLabel}">
                                <TextBlock Text="&#xE711;" FontFamily="Segoe MDL2 Assets" FontSize="12" Foreground="{StaticResource DangerBrush}"/>
                            </Button>

                            <TextBox Text="{Binding BusinessSoftware, UpdateSourceTrigger=PropertyChanged}" 

                                     Style="{StaticResource ModernTextBoxStyle}"/>

                        </DockPanel>

                        <!-- Running processes list with select -->
                        <DockPanel Margin="0,0,0,8">
                            <Button DockPanel.Dock="Right" Style="{StaticResource SecondaryButtonStyle}" MinWidth="120" Command="{Binding RefreshProcessesCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="&#xE72C;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding RefreshProcessesButtonText}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                            <TextBlock Text="{Binding RunningProcessesLabel}" Style="{StaticResource SectionLabelStyle}" 
                                       VerticalAlignment="Center" Margin="0,0,10,0"/>
                        </DockPanel>
                        <ListBox ItemsSource="{Binding RunningProcesses}" Height="150" Style="{StaticResource ModernListBoxStyle}"
                                 SelectedItem="{Binding SelectedProcess}"/>
                        <Button Style="{StaticResource SecondaryButtonStyle}" MinWidth="160" Margin="0,10,0,0"
                                HorizontalAlignment="Left" Command="{Binding SelectProcessCommand}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE73E;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding UseSelectedProcessLabel}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!-- ===== STICKY SAVE FOOTER ===== -->
        <Border Grid.Row="2" Background="{StaticResource CardBackgroundBrush}"
                BorderBrush="{StaticResource InputBorderBrush}" BorderThickness="0,1,0,0" Padding="16,12">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <!-- Save confirmation -->
                <Border Background="#E8F5E9" BorderBrush="#4CAF50" BorderThickness="1" CornerRadius="8"
                        Padding="12,8" Margin="0,0,12,0" VerticalAlignment="Center"
                        Visibility="{Binding IsSaveConfirmVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE73E;" FontFamily="Segoe MDL2 Assets" FontSize="14"
                                   Foreground="#4CAF50" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="{Binding StatusMessage}" FontSize="13" Foreground="#2E7D32"
                                   FontFamily="{StaticResource AppFont}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
                <!-- Save button -->
                <Button Style="{StaticResource PrimaryButtonStyle}" MinWidth="180"
                        Command="{Binding SaveSettingsCommand}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE74E;" FontFamily="Segoe MDL2 Assets" FontSize="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="{Binding SaveButtonText}" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
